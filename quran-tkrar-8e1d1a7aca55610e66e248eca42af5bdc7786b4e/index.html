<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=" (برنامج سهل الاستخدام ) تطبيق القرآن الكريم: حفظ وتسميع وتكرار وتفسير واستماع وبحث واذكار">
    <title>القرآن الكريم | >إِستماع وتفسير وحفظ بالتكرار وتسميع وبحث وأذكار (برنامج سهل الاستخدام )</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        @font-face {
            font-family: 'UthmanicHafs';
            src:
                url('fonts/HafsSmart_08.ttf') format('truetype'),
                /* url('fonts/hafssmart_08-webfont.woff2') format('woff2'), */
                url('fonts/hafssmart_08-webfont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

        .quran-text {
            font-family: 'UthmanicHafs', 'Amiri', serif !important;
            font-size: 2rem;
            line-height: 4rem;
            direction: rtl;
            letter-spacing: 0.01em;
            word-spacing: 0.1em;
            text-align: center;
            color: #1e293b;
        }

        /* .dark .quran-text {
            color: var(--navy-blue);
        }

         */


        .zedee {
            z-index: 10;
        }


        :root {
            --primary-light: #38b6ff;
            --primary-dark: #2563eb;
            --dark-bg: #0f172a;
            --darker-bg: #0a1122;
            --dark-text: #e2e8f0;
            --navy-blue: #1e3a8a;
            --gold: #e4b04d;
            --gold-dark: #d49c3d;
        }

        * {
            transition: background-color 0.3s ease, color 0.3s ease;
        }


        footer {
            background-color: #f1f1f1;
            padding: 20px 10px;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* يحط كل شي في النص */
            text-align: center;
        }

        .logo {
            width: 128px;
            height: auto;
            margin-bottom: 0px;
        }

        footer p {
            margin: 5px 0;
            font-size: 15px;
            font-style: bold;
            color: #9a9a9e;
            font-family: sans-serif;
        }




        /* -----------------style----------------- */

        .search-results-container {
            background-color: #f9fafb;
            border-radius: 0.75rem;
            margin-top: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .dark .search-results-container {
            background-color: #1e293b;
            border: 1px solid #334155;
        }

        .search-result {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result:hover {
            background-color: #edf2f7;
        }

        .dark .search-result {
            border-bottom: 1px solid #334155;
        }

        .dark .search-result:hover {
            background-color: #334155;
        }

        .search-result .quran-text {
            font-size: 1.5rem;
            line-height: 2.5rem;
            text-align: right;
            color: #1e293b;
            text-align: center;
        }

        .dark .search-result .quran-text {
            color: #e2e8f0;
        }

        .search-result .surah-info {
            font-size: 0.875rem;
            color: #64748b;
        }

        .dark .search-result .surah-info {
            color: #94a3b8;

        }


        /* ---------------------------

*/

        .fa-moon,
        .fa-bell {
            color: var(--primary-light) !important;
        }




        .results-count {
            color: #1e293b !important;
            /* لون داكن للوضع الفاتح */
            padding: 0.5rem;
            text-align: center;
            font-weight: bold;
        }

        .dark .results-count {
            color: #e2e8f0 !important;
            /* لون فاتح للوضع الداكن */
        }


        /* -----------------style----------------- */





        body {
            font-family: 'Amiri', serif;
            background-color: #f5f7fa;
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
        }

        /*         
        .dark {
            background: linear-gradient(135deg, var(--darker-bg), var(--dark-bg));
            color: var(--dark-text);
        } */







        .dark,
        .dark * {
            color: white !important;
            background-color: var(--darker-bg) !important;
            border-color: var(--gold-dark) !important;
            /* اختياري للكحلي */
        }

        .dark .exception {
            background-color: var(--gold-dark) !important;
            color: var(--darker-bg) !important;
            /* أصفر */
        }


        .dark .transparent-bg {
            background-color: transparent !important;
        }



        .surah-name {
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dark .surah-name {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ayah-text {
            font-size: 2.5rem;
            line-height: 3.5rem;
            text-align: center;
            margin: 1.5rem 0;
            color: #1e293b;
        }

        .dark .ayah-text {
            color: var(--navy-blue);
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .dark .control-btn {
            background-color: var(--gold);
        }

        .play-btn {
            width: 60px;
            height: 60px;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            background-color: #e2e8f0;
        }

        .dark .tab-btn {
            background-color: #1e293b;
            color: var(--dark-text);
        }

        .tab-btn.active {
            background-color: var(--primary-light);
            color: white;
        }

        .dark .tab-btn.active {
            /* background-color: var(--gold-dark) !important; */
            border: solid 2px var(--gold-dark) !important;
            border-color: var(--gold-dark) !important;
        }


        .bordrnow {
            border: solid 2px var(--gold-dark) !important;
        }

        .section-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background-color: #edf2f7;
            cursor: pointer;
        }

        .dark .section-toggle {
            background-color: #1e293b;
            color: var(--dark-text);
        }

        .section-content {
            padding: 1rem;
            background-color: white;
            border-radius: 0.75rem;
            margin-top: 0.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .dark .section-content {
            background-color: #1e293b;
            color: var(--dark-text);
        }

        .dark #play-pause-btn {
            background-color: var(--gold-dark) !important;
            line-height: 0% !important;

        }

        .dark #play-pause-btn i {

            line-height: 0% !important;

        }

        .dark #start-tasmee {
            background-color: var(--gold-dark) !important;
            color: white !important;
            border: solid 2px var(--gold-dark) !important;
        }


        .dark #play-pause-btn i {
            color: white !important;
        }

        .dark #activate-repeat {
            border: solid 2px var(--gold-dark) !important;

        }


        .dark i {
            color: var(--gold-dark) !important;
        }

        .time-picker {
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid #cbd5e0;
            background-color: #f7fafc;
            width: 100%;
            text-align: center;
        }

        .dark .time-picker {
            background-color: #334155;
            border-color: #475569;
            color: var(--dark-text);
        }

        .reminder-card {
            background-color: #f1f5f9;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .dark .reminder-card {
            background-color: #1e293b;
            border: 1px solid #334155;
        }

        .reminder-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 0.5rem;
        }

        .dark .reminder-header {
            border-color: #334155;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: auto;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e0;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary-light);
        }

        .dark input:checked+.slider {
            background-color: var(--gold) !important;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            cursor: pointer;
        }

        .dark .install-btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .ayah-text {
                font-size: 1.8rem;
                line-height: 2.8rem;
            }

            .surah-name {
                font-size: 1.8rem;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ayah-placeholder {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 60px;
            height: 60px;
            background-color: white;
            border: 2px solid var(--primary-light);
            color: var(--primary-light);
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.125rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            user-select: none;
        }

        .dark .ayah-placeholder {
            background-color: #1e293b;
            border-color: var(--gold);
            color: var(--gold);
        }

        .ayah-placeholder:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(56, 182, 255, 0.4);
        }

        .ayah-placeholder.revealed {
            width: auto;
            height: auto;
            min-width: 200px;
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 1.5rem;
            line-height: 2.5rem;
            text-align: center;
            background-color: #dbeafe;
        }

        .dark .ayah-placeholder.revealed {
            background-color: var(--navy-blue);
            color: white;
        }

        .reminder-time {
            background-color: var(--primary-light);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.9rem;
        }

        .dark .reminder-time {
            background-color: var(--gold);
            color: #1e293b;
        }

        .dhikr-card {
            background-color: #dbeafe;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            line-height: 2rem;
        }

        .dark .dhikr-card {
            background-color: #1e293b;
            border: 1px solid var(--gold);
        }

        .dhikr-title {
            color: var(--primary-dark);
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark .dhikr-title {
            color: var(--gold);
        }

        /* تحسينات للوضع الداكن */
        .dark select,
        .dark input,
        .dark textarea {
            background-color: #1e293b;
            color: var(--dark-text);
            border-color: #475569;
        }

        .dark .section-content {
            background-color: #1e293b;
            border: 1px solid #334155;
        }

        .dark .tab-btn {
            color: var(--dark-text);
        }

        .dhikr-text {
            font-size: 1.4rem;
            line-height: 2.5rem;
            text-align: center;
        }

        .notification-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .notification-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark .dhikr-card {
            color: #e4b04d !important;
        }


        .tashkeel-red {
            color: #e11d48 !important;
            font-weight: bold;
        }
    </style>
</head>

<link rel="icon" href="favicon.ico" type="image/x-icon">

<body class="bg-gray-50 dark:bg-dark-bg">
    <!-- Install Button -->
    <button id="install-button" class="install-btn hidden">
        <i class="fas fa-download"></i> تثبيت التطبيق
    </button>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="fixed bottom-20 left-4 bg-red-500 text-white px-4 py-2 rounded-full hidden">
        <i class="fas fa-wifi-slash mr-2"></i> أنت متصل حالياً دون إنترنت
    </div>

    <!-- App Container -->
    <div class="container mx-auto max-w-4xl p-4 min-h-screen">
        <!-- Header -->
        <header class="text-center py-6 relative">
            <h1 class="surah-name text-3xl font-bold mb-2 zedee">القرآن الكريم</h1>
            <p class="text-gray-600 dark:text-gray-300"> حفظ وتسميع وتكرار وتفسير واستماع وبحث واذكار</p>

            <div class="absolute top-0 left-0 right-0 flex justify-between px-4 transparent-bg">
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                <button id="notification-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
                    <i class="fas fa-bell"></i>
                </button>
            </div>
        </header>

        <!-- Tabs -->
        <div class="flex gap-2 mb-6 overflow-x-auto">
            <button data-tab="player" class="tab-btn active flex-1 min-w-max">استماع وتفسير</button>
            <button data-tab="tasmee" class="tab-btn flex-1 min-w-max">تسميع</button>
            <button data-tab="reminders" class="tab-btn flex-1 min-w-max">أذكار</button>
        </div>

        <!-- Player Tab -->
        <div id="player-tab" class="tab-content">
            <!-- Surah Info -->
            <div id="backplayer" class="bg-white dark:bg-darker-bg rounded-xl p-6 shadow-md mb-6 fade-in">
                <div class="text-center">
                    <h2 id="surah-title" class="surah-name text-2xl font-bold">سورة الفاتحة</h2>
                    <p id="ayah-text" class="ayah-text">بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ</p>
                    <p id="ayah-number" class="text-blue-500 dark:text-yellow-300 font-medium">(الآية: 1)</p>
                </div>

                <!-- Player Controls -->
                <div class="flex justify-center items-center gap-4 my-6">
                    <button id="prev-btn" class="control-btn">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button id="play-pause-btn" class="control-btn play-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="next-btn" class="control-btn">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>

                <!-- Tafsir -->
                <div class="bg-gray-100 dark:bg-darker-bg p-4 rounded-lg mt-4">
                    <h3 class="font-bold text-lg mb-2">تفسير الآية</h3>
                    <p id="tafsir-text" class="text-gray-700 dark:text-gray-300">
                        افتتح الله تعالى كتابه بهذه الآية ليرشد عباده إلى أن يبدؤوا بأسمه، كما بدأ بها، وهي إخبار من
                        الله تعالى بأنه سمى نفسه باسم الله الرحمن الرحيم.
                    </p>
                </div>
            </div>

            <!-- Settings -->
            <div class="bg-white dark:bg-darker-bg rounded-xl p-6 shadow-md mb-6">
                <h3 class="font-bold text-xl mb-4 text-center">إعدادات التشغيل</h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block mb-2 font-medium">السورة</label>
                        <select id="surah-select"
                            class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            <!-- سيتم تعبئة الخيارات ديناميكيًا -->
                        </select>
                    </div>

                    <div>
                        <label class="block mb-2 font-medium">القارئ</label>
                        <select id="reciter-select"
                            class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            <!-- سيتم تعبئة الخيارات ديناميكيًا -->
                        </select>
                    </div>

                    <div>
                        <label class="block mb-2 font-medium">التفسير</label>
                        <select id="tafsir-select"
                            class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            <!-- سيتم تعبئة الخيارات ديناميكيًا -->
                        </select>
                    </div>
                </div>

                <!-- Repetition Section -->
                <div class="mb-6">
                    <div class="section-toggle" id="repeat-toggle">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-redo text-blue-500 dark:text-yellow-400"></i>
                            <span class="font-bold">خاصية التكرار</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div id="repeat-section" class="section-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-2">من آية</label>
                                <input id="repeat-start" type="number" min="1" value="1"
                                    class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            </div>

                            <div>
                                <label class="block mb-2">إلى آية</label>
                                <input id="repeat-end" type="number" min="1" value="1"
                                    class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            </div>

                            <div>
                                <label class="block mb-2">عدد التكرارات</label>
                                <input id="repeat-count" type="number" min="1" value="3"
                                    class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                            </div>

                            <div>
                                <label class="block mb-2">الفاصل الزمني</label>
                                <select id="repeat-delay"
                                    class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                                    <option value="0">بدون انتظار</option>
                                    <option value="0.5">نصف مدة الآية</option>
                                    <option value="1">مدة الآية كاملة</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-4 flex justify-center">
                            <button id="activate-repeat"
                                class="bg-blue-500 dark:bg-yellow-500 text-white px-6 py-2 rounded-lg">
                                تفعيل التكرار
                            </button>
                        </div>
                        <p id="repeat-status" class="text-center mt-2 text-sm text-blue-500 dark:text-yellow-400"></p>
                    </div>
                </div>

                <!-- Search Form -->
                <div class="mb-6">
                    <div class="relative">
                        <input id="search-query" type="text" placeholder="ابحث في القرآن الكريم..." class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 
                                      bg-gray-50 dark:bg-gray-800 focus:outline-none focus:ring-2 
                                      focus:ring-blue-500 dark:focus:ring-yellow-500 text-gray-800 dark:text-gray-200">
                        <button id="search-button" class="absolute left-3 top-1/2 transform -translate-y-1/2 
                                 text-gray-500 dark:text-gray-400">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div id="search-results-container" class="hidden"></div>
                </div>
            </div>
        </div>

        <!-- Tasmee Tab -->
        <div id="tasmee-tab" class="tab-content hidden">
            <div class="bg-white dark:bg-darker-bg rounded-xl p-6 shadow-md">
                <h3 class="font-bold text-xl mb-4 text-center">وضع التسميع</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block mb-2">من آية</label>
                        <input id="tasmee-start" type="number" min="1" value="1"
                            class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                    </div>

                    <div>
                        <label class="block mb-2">إلى آية</label>
                        <input id="tasmee-end" type="number" min="1" value="7"
                            class="w-full p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                    </div>
                </div>

                <div class="flex justify-center">
                    <button id="start-tasmee"
                        class="bg-blue-500 dark:bg-yellow-500 text-white px-8 py-3 rounded-lg text-lg font-bold">
                        بدء التسميع
                    </button>
                </div>

                <div id="tasmee-output" class="mt-8 flex flex-wrap justify-center items-start gap-4">
                    <!-- Ayah placeholders will be added dynamically -->
                </div>
            </div>
        </div>

        <!-- Mushaf Tab -->
        <div id="mushaf-tab" class="tab-content hidden">
            <div class="bg-white dark:bg-darker-bg rounded-xl p-6 shadow-md">
                <h3 class="font-bold text-xl mb-4 text-center">عرض المصحف</h3>

                <div class="flex flex-col sm:flex-row gap-4 items-center justify-center mb-6">
                    <div class="flex items-center gap-2">
                        <label>رقم الصفحة:</label>
                        <input id="mushaf-page" type="number" min="1" max="604" value="1"
                            class="w-20 p-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                    </div>

                    <button id="show-mushaf" class="bg-blue-500 dark:bg-yellow-500 text-white px-6 py-2 rounded-lg">
                        عرض الصفحة
                    </button>
                </div>

                <div id="mushaf-container"
                    class="bg-gray-200 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl w-full h-96 flex items-center justify-center">
                    <p class="text-gray-500 dark:text-gray-400">صفحة المصحف ستظهر هنا</p>
                </div>
            </div>
        </div>

        <!-- Reminders Tab -->
        <div id="reminders-tab" class="tab-content hidden">
            <div class="bg-white dark:bg-darker-bg rounded-xl p-6 shadow-md">
                <h3 class="font-bold text-xl mb-4 text-center">تذكير الأذكار</h3>

                <!-- Notification Settings -->
                <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg mb-6">
                    <h3 class="font-bold text-lg mb-3">إعدادات الإشعارات</h3>

                    <div class="notification-control">
                        <span>تفعيل الإشعارات:</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="global-notification-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>

                    <p class="text-sm text-gray-600 dark:text-gray-300 mt-2">
                        قم بتفعيل الإشعارات لتلقي تذكير بالأذكار في الأوقات المحددة
                    </p>
                </div>

                <!-- Reminder Cards -->
                <div class="reminder-card">
                    <div class="reminder-header">
                        <i class="fas fa-sun text-yellow-500"></i>
                        <span class="font-bold">أذكار الصباح</span>
                        <div class="notification-toggle">
                            <span>التنبيه:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="morning-reminder-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-3 flex items-center gap-3">
                        <label>وقت التنبيه:</label>
                        <input type="time" id="morning-time" class="time-picker" value="06:00">
                    </div>

                    <div class="mt-4">
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الأول</span>
                            </div>
                            <p class="dhikr-text">
                                اللهم أنت ربي لا إله إلا أنت خلقتني وأنا عبدك وأنا على عهدك ووعدك ما استطعت أعوذ بك من
                                شر ما صنعت أبوء لك بنعمتك علي وأبوء بذنبي فاغفر لي فإنه لا يغفر الذنوب إلا أنت
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثاني</span>
                            </div>
                            <p class="dhikr-text">
                                أصبحنا وأصبح الملك لله والحمد لله لا إله إلا الله وحده لا شريك له له الملك وله الحمد وهو
                                على كل شيء قدير رب أسألك خير ما في هذا اليوم وخير ما بعده وأعوذ بك من شر ما في هذا اليوم
                                وشر ما بعده رب أعوذ بك من الكسل وسوء الكبر رب أعوذ بك من عذاب في النار وعذاب في القبر
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثالث </span>
                            </div>
                            <p class="dhikr-text">
                                اللهم عالم الغيب والشهادة فاطر السموات والأرض رب كل شيء ومليكه أشهد أن لا إله إلا أنت
                                أعوذ بك من شر نفسي ومن شر من شر الشيطان وشركه وأن أقترف على نفسي سوءًا أو أجره إلى مسلم.
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الرابع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ أصبحنا على فطرة الإسلام وكلمة الإخلاص ودين نبينا محمد ﷺ وملة أبينا إبراهيم حنيفًا
                                مسلمًا وما كان من المشركين.
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الخامس</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ اللهم إني أسألك العافية في الدنيا والآخرة اللهم إني أسألك العفو والعافية في ديني
                                ودنياي وأهلي ومالي اللهم استر عوراتي وآمن روعاتي اللهم إحفظني من بين يدي ومن خلفي وعن
                                يميني وعن شمالي ومن فوقي وأعوذ بعظمتك أن أغتال من تحتي.
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السادس</span>
                            </div>
                            <p class="dhikr-text">
                                سبحان الله وبحمده عدد خلقه ورضا نفسه وزنة عرشه ومداد كلماته (3 مرات).
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السابع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ أعوذ بكلمات الله التامات من شر ما خلق (3 مرات).
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثامن</span>
                            </div>
                            <p class="dhikr-text">
                                بسم الله الذي لا يضر مع اسمه شيء في الأرض ولا في السماء وهو السميع العليم (3 مرات).
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر التاسع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ لا إله إلا الله وحده لا شريك له له الملك وله الحمد يحيي ويميت وهو على كل شيء قدير (10
                                مرات).
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر العاشر</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ (قل هو الله أحد قل أعوذ برب الفلق قل أعوذ برب الناس) (3 مرات)
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الحادي عشر</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ سبحان الله وبحمده (100 مرة).
                            </p>
                        </div>
                    </div>
                </div>

                <div class="reminder-card">
                    <div class="reminder-header">
                        <i class="fas fa-moon text-indigo-500"></i>
                        <span class="font-bold">أذكار المساء</span>
                        <div class="notification-toggle">
                            <span>التنبيه:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="evening-reminder-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-3 flex items-center gap-3">
                        <label>وقت التنبيه:</label>
                        <input type="time" id="evening-time" class="time-picker" value="18:00">
                    </div>

                    <div class="mt-4">
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الأول</span>
                            </div>
                            <p class="dhikr-text">
                                اللهم أنت ربي لا إله إلا أنت خلقتني وأنا عبدك وأنا على عهدك ووعدك ما استطعت أعوذ بك من
                                شر ما صنعت أبوء لك بنعمتك علي وأبوء بذنبي فاغفر لي فإنه لا يغفر الذنوب إلا أنت
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثاني</span>
                            </div>
                            <p class="dhikr-text">
                                أمسينا وأمسى الملك لله والحمد لله لا إله إلا الله وحده لا شريك له له الملك وله الحمد وهو
                                على كل شيء قدير رب أسألك خير ما في هذه الليلة وخير ما بعدها وأعوذ بك من شر ما في هذه
                                الليلة وشر ما بعدها رب أعوذ بك من الكسل وسوء الكبر رب أعوذ بك من عذاب في النار وعذاب في
                                القبر
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثالث </span>
                            </div>
                            <p class="dhikr-text">
                                اللهم عالم الغيب والشهادة فاطر السموات والأرض رب كل شيء ومليكه أشهد أن لا إله إلا أنت
                                أعوذ بك من شر نفسي ومن شر من شر الشيطان وشركه وأن أقترف على نفسي سوءًا أو أجره إلى مسلم.
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الرابع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ أمسينا على فطرة الإسلام وكلمة الإخلاص ودين نبينا محمد ﷺ وملة أبينا إبراهيم حنيفًا
                                مسلمًا وما كان من المشركين.
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الخامس</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ اللهم إني أسألك العافية في الدنيا والآخرة اللهم إني أسألك العفو والعافية في ديني
                                ودنياي وأهلي ومالي اللهم استر عوراتي وآمن روعاتي اللهم إحفظني من بين يدي ومن خلفي وعن
                                يميني وعن شمالي ومن فوقي وأعوذ بعظمتك أن أغتال من تحتي.
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السادس</span>
                            </div>
                            <p class="dhikr-text">
                                سبحان الله وبحمده عدد خلقه ورضا نفسه وزنة عرشه ومداد كلماته (3 مرات).
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السابع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ أعوذ بكلمات الله التامات من شر ما خلق (3 مرات).
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثامن</span>
                            </div>
                            <p class="dhikr-text">
                                بسم الله الذي لا يضر مع اسمه شيء في الأرض ولا في السماء وهو السميع العليم (3 مرات).
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر التاسع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ لا إله إلا الله وحده لا شريك له له الملك وله الحمد يحيي ويميت وهو على كل شيء قدير (10
                                مرات).
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر العاشر</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ (قل هو الله أحد قل أعوذ برب الفلق قل أعوذ برب الناس) (3 مرات)
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الحادي عشر</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ سبحان الله وبحمده (100 مرة).
                            </p>
                        </div>
                    </div>
                </div>

                <div class="reminder-card">
                    <div class="reminder-header">
                        <i class="fas fa-bed text-blue-500"></i>
                        <span class="font-bold">أذكار النوم</span>
                        <div class="notification-toggle">
                            <span>التنبيه:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sleep-reminder-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="mt-3 flex items-center gap-3">
                        <label>وقت التنبيه:</label>
                        <input type="time" id="sleep-time" class="time-picker" value="22:00">
                    </div>

                    <div class="mt-4">
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الأول</span>
                            </div>
                            <p class="dhikr-text">
                                ٱللَّهُ لَآ إِلَٰهَ إِلَّا هُوَ ٱلۡحَيُّ ٱلۡقَيُّومُۚ لَا تَأۡخُذُهُۥ سِنَةٞ وَلَا
                                نَوۡمٞۚ لَّهُۥ مَا فِي ٱلسَّمَٰوَٰتِ وَمَا فِي ٱلۡأَرۡضِۗ مَن ذَا ٱلَّذِي يَشۡفَعُ
                                عِندَهُۥٓ إِلَّا بِإِذۡنِهِۦۚ يَعۡلَمُ مَا بَيۡنَ أَيۡدِيهِمۡ وَمَا خَلۡفَهُمۡۖ وَلَا
                                يُحِيطُونَ بِشَيۡءٖ مِّنۡ عِلۡمِهِۦٓ إِلَّا بِمَا شَآءَۚ وَسِعَ كُرۡسِيُّهُ
                                ٱلسَّمَٰوَٰتِ وَٱلۡأَرۡضَۖ وَلَا يَـُٔودُهُۥ حِفۡظُهُمَاۚ وَهُوَ ٱلۡعَلِيُّ ٱلۡعَظِيمُ
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثاني</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ (قل هو الله أحد قل أعوذ برب الفلق قل أعوذ برب الناس) 3 مرات
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثالث</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ باسمك ربي وضعت جنبي وبك أرفعه إن أمسكت نفسي فارحمها وإن أرسلتها فاحفظها بما تحفظ به
                                عبادك الصالحين
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الرابع</span>
                            </div>
                            <p class="dhikr-text">
                                ♦ تكبير 34 تسبيح 33 تحميد 33
                            </p>
                        </div>

                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الخامس</span>
                            </div>
                            <p class="dhikr-text">
                                (3 مرات) اللّهُـمَّ قِنـي عَذابَـكَ يَـوْمَ تَبْـعَثُ عِبـادَك.
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السادس</span>
                            </div>
                            <p class="dhikr-text">
                                الحمد لله الذي أطعمنا وسقانا وكفانا فكم ممن لا كافي له ولا مؤوي.
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر السابع</span>
                            </div>
                            <p class="dhikr-text">
                                اللهم رب السموات والأرض رب العرش العظيم ربنا ورب كل شيء فالق الحب والنوى ومنزل التوراة
                                والإنجيل والفرقان أعوذ بك من شر كل ذي شر أنت آخذ بناصيته أنت الأول فليس قبلك شيء وأنت
                                الآخر فليس بعدك شيء وأنت الظاهر فليس فوقك شيء وأنت الباطن فليس دونك شيء إقض عنا الدين
                                وأغننا من الفقر.
                            </p>
                        </div>
                        <div class="dhikr-card">
                            <div class="dhikr-title">
                                <i class="fas fa-star"></i>
                                <span>الذكر الثامن</span>
                            </div>
                            <p class="dhikr-text">
                                . ♦ اللهم إني أسلمت نفسي إليك ووجهت وجهي إليك وفوضت أمري إليك وألجأت ظهري إليك رغبة
                                ورهبة إليك لا ملجأ ولا منجا منك إلا إليك آمنت بكتابك الذي أنزلت وبنبيك الذي أرسلت.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="footer-content">
            <img src="icons/icon-128x128.png" alt="شعار الموقع" class="logo">
            <p>هذا الموقع مجاني لوجه الله تعالى، نسأل الله القبول</p>
            <p>لا اشتراكات، لا إعلانات، ممنوع التبرعات</p>
            maaab.academy@gmail.com
        </div>
    </footer>

    <script>


        document.addEventListener('DOMContentLoaded', async function () {
            // DOM Elements
            const themeToggle = document.getElementById('theme-toggle');
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const playBtn = document.getElementById('play-pause-btn');
            const playIcon = playBtn.querySelector('i');
            const surahSelect = document.getElementById('surah-select');
            const reciterSelect = document.getElementById('reciter-select');
            const tafsirSelect = document.getElementById('tafsir-select');
            const searchQuery = document.getElementById('search-query');
            const searchResultsContainer = document.getElementById('search-results-container');
            const surahTitle = document.getElementById('surah-title');
            const ayahText = document.getElementById('ayah-text');
            const ayahNumber = document.getElementById('ayah-number');
            const tafsirText = document.getElementById('tafsir-text');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const repeatStart = document.getElementById('repeat-start');
            const repeatEnd = document.getElementById('repeat-end');
            const repeatCount = document.getElementById('repeat-count');
            const repeatDelay = document.getElementById('repeat-delay');
            const activateRepeat = document.getElementById('activate-repeat');
            const repeatStatus = document.getElementById('repeat-status');
            const audioPlayer = new Audio();
            const startTasmee = document.getElementById('start-tasmee');
            const tasmeeStart = document.getElementById('tasmee-start');
            const tasmeeEnd = document.getElementById('tasmee-end');
            const tasmeeOutput = document.getElementById('tasmee-output');
            const mushafPage = document.getElementById('mushaf-page');
            const showMushaf = document.getElementById('show-mushaf');
            const mushafContainer = document.getElementById('mushaf-container');
            const installButton = document.getElementById('install-button');
            const offlineIndicator = document.getElementById('offline-indicator');
            const searchButton = document.getElementById('search-button');

            const reciterArabicNames = {
                "ar.alafasy": "مشاري العفاسي",
                "ar.abdulbasitmurattal": "عبد الباسط عبد الصمد (مرتل)",
                "ar.abdurrahmaansudais": "عبد الرحمن السديس",
                "ar.shaatree": "أبو بكر الشاطري",
                "ar.husary": "محمود خليل الحصري",
                "ar.hudhaify": "علي عبد الله جابر",
                "ar.aymanswoaid": "أيمن سويد",
                "ar.minshawi": "محمد صديق المنشاوي",
                "ar.muhammadjibreel": "محمد جبريل",
                "ar.mahermuaiqly": "ماهر المعيقلي",
                "ar.ibrahimakhbar": "إبراهيم الأخضر",
                "ar.hanirifai": "هاني الرفاعي",
                "ar.ahmedajamy": "أحمد بن علي العجمي",
                "ar.muhammadayyoub": "محمد أيوب"
            };

            // App State
            let currentTheme = localStorage.getItem('theme') || 'light';
            let currentSurah = 1;
            let currentAyah = 0;
            let isPlaying = false;
            let repeatActive = false;
            let repeatCounter = 0;
            let surahs = [];
            let reciters = [];
            let tafsirs = [];
            let currentSurahData = null;
            let currentTafsirData = null;
            let repeatRange = { start: 0, end: 0 };
            let deferredPrompt = null;
            let timeoutId = null;
            let ayaData = [];

            // Reminder settings
            let globalNotificationsEnabled = true;
            let morningReminderEnabled = true;
            let eveningReminderEnabled = true;
            let sleepReminderEnabled = true;

            // Set initial theme
            if (currentTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }

            // Theme Toggle
            // تعيين المظهر المبدئي
            if (currentTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeToggle.querySelector('i').classList.replace('fa-moon', 'fa-sun');
            }

            // تبديل المظهر
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                localStorage.setItem('theme', currentTheme);

                if (currentTheme === 'dark') {
                    themeToggle.querySelector('i').classList.replace('fa-moon', 'fa-sun');
                } else {
                    themeToggle.querySelector('i').classList.replace('fa-sun', 'fa-moon');
                }
            });

            // Tab Switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    tab.classList.add('active');

                    // Hide all tab contents
                    tabContents.forEach(content => content.classList.add('hidden'));

                    // Show the selected tab content
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                });
            });

            // Toggle Sections
            const toggleSection = (toggleId, sectionId) => {
                const toggle = document.getElementById(toggleId);
                const section = document.getElementById(sectionId);
                const icon = toggle.querySelector('.fa-chevron-down');

                toggle.addEventListener('click', () => {
                    section.classList.toggle('hidden');
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                });
            };

            toggleSection('repeat-toggle', 'repeat-section');

            // Play/Pause Button
            playBtn.addEventListener('click', () => {
                if (playIcon.classList.contains('fa-play')) {
                    playIcon.classList.remove('fa-play');
                    playIcon.classList.add('fa-pause');
                    isPlaying = true;
                    playAyah();
                } else {
                    playIcon.classList.remove('fa-pause');
                    playIcon.classList.add('fa-play');
                    isPlaying = false;
                    audioPlayer.pause();
                    if (timeoutId) clearTimeout(timeoutId);
                }
            });

            // Previous Ayah
            prevBtn.addEventListener('click', () => {
                if (currentAyah > 0) {
                    currentAyah--;
                    updateAyahDisplay();
                }
            });

            // Next Ayah
            nextBtn.addEventListener('click', () => {
                if (currentSurahData && currentAyah < currentSurahData.ayahs.length - 1) {
                    currentAyah++;
                    updateAyahDisplay();
                }
            });

            // Surah Selection
            surahSelect.addEventListener('change', async function () {
                currentSurah = parseInt(this.value);
                currentAyah = 0;
                await loadSurahData();
                await loadTafsirData();
                updateAyahDisplay();
            });

            // Reciter Selection
            reciterSelect.addEventListener('change', async function () {
                await loadSurahData();
                updateAyahDisplay();
            });

            // Tafsir Selection
            tafsirSelect.addEventListener('change', async function () {
                await loadTafsirData();
                updateAyahDisplay();
            });

            // Search Functionality
            searchButton.addEventListener('click', function () {
                const query = searchQuery.value.trim();
                if (query) searchAyat(query);
            });

            searchQuery.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const query = searchQuery.value.trim();
                    if (query) searchAyat(query);
                }
            });

            // Repeat Activation
            activateRepeat.addEventListener('click', function () {
                const start = parseInt(repeatStart.value) - 1;
                const end = parseInt(repeatEnd.value) - 1;

                if (start < 0 || end < start || end >= currentSurahData.ayahs.length) {
                    alert('الرجاء تحديد نطاق آيات صحيح');
                    return;
                }

                repeatActive = true;
                repeatCounter = 0;
                repeatRange = { start, end };
                repeatStatus.textContent = 'تم تفعيل خاصية التكرار';

                // البدء من أول آية في النطاق
                currentAyah = start;
                updateAyahDisplay();
                playAyah();
            });

            // Audio Ended Event
            audioPlayer.addEventListener('ended', function () {
                const delayFactor = parseFloat(repeatDelay.value);
                const currentDuration = audioPlayer.duration;
                const delay = (isNaN(currentDuration) || delayFactor === 0) ? 0 : currentDuration * delayFactor * 1000;

                if (repeatActive) {
                    if (currentAyah < repeatRange.end) {
                        // الانتقال للآية التالية في النطاق
                        if (delay > 0) {
                            timeoutId = setTimeout(() => {
                                currentAyah++;
                                updateAyahDisplay();
                                playAyah();
                            }, delay);
                        } else {
                            currentAyah++;
                            updateAyahDisplay();
                            playAyah();
                        }
                    } else {
                        // عند الوصول لنهاية النطاق، نزيد العداد ونبدأ من جديد
                        repeatCounter++;
                        if (repeatCounter < parseInt(repeatCount.value)) {
                            if (delay > 0) {
                                timeoutId = setTimeout(() => {
                                    currentAyah = repeatRange.start;
                                    updateAyahDisplay();
                                    playAyah();
                                }, delay);
                            } else {
                                currentAyah = repeatRange.start;
                                updateAyahDisplay();
                                playAyah();
                            }
                        } else {
                            // انتهاء التكرارات
                            repeatActive = false;
                            isPlaying = false;
                            playIcon.classList.remove('fa-pause');
                            playIcon.classList.add('fa-play');
                            repeatStatus.textContent = 'تم الانتهاء من التكرار';
                        }
                    }
                } else if (currentSurahData && currentAyah < currentSurahData.ayahs.length - 1) {
                    // تشغيل عادي بدون تكرار
                    if (delay > 0) {
                        timeoutId = setTimeout(() => {
                            currentAyah++;
                            updateAyahDisplay();
                            playAyah();
                        }, delay);
                    } else {
                        currentAyah++;
                        updateAyahDisplay();
                        playAyah();
                    }
                } else {
                    // نهاية السورة
                    isPlaying = false;
                    playIcon.classList.remove('fa-pause');
                    playIcon.classList.add('fa-play');
                }
            });

            // Tasmee Start
            startTasmee.addEventListener('click', function () {
                const start = parseInt(tasmeeStart.value);
                const end = parseInt(tasmeeEnd.value);

                if (start < 1 || end < start || !currentSurahData) {
                    alert('الرجاء إدخال نطاق آيات صحيح وتحميل السورة أولاً');
                    return;
                }

                generateTasmeePlaceholders(start, end);
            });

            // Mushaf Display
            showMushaf.addEventListener('click', function () {
                const page = parseInt(mushafPage.value);
                if (page < 1 || page > 604) {
                    alert('الرجاء إدخال رقم صفحة صحيح بين 1 و 604');
                    return;
                }

                mushafContainer.innerHTML = `
                    <img src="https://cdn.islamic.network/quran/images/${page}.png" 
                         alt="صفحة ${page} من المصحف" 
                         class="w-full h-auto rounded-lg shadow-lg">
                `;
            });

            // Functions
            async function fetchInitialData() {
                try {
                    // جلب بيانات السور
                    const surahsRes = await fetch('https://api.alquran.cloud/v1/surah');
                    if (!surahsRes.ok) throw new Error('فشل في جلب بيانات السور');
                    const surahsData = await surahsRes.json();
                    surahs = surahsData.data;

                    // جلب بيانات القراء
                    const recitersRes = await fetch('https://api.alquran.cloud/v1/edition/format/audio');
                    if (!recitersRes.ok) throw new Error('فشل في جلب بيانات القراء');
                    const recitersData = await recitersRes.json();
                    reciters = recitersData.data;

                    // جلب بيانات التفاسير
                    const tafsirsRes = await fetch('https://api.alquran.cloud/v1/edition/type/tafsir');
                    if (!tafsirsRes.ok) throw new Error('فشل في جلب بيانات التفاسير');
                    const tafsirsData = await tafsirsRes.json();
                    tafsirs = tafsirsData.data.filter(t => t.language === 'ar');

                    // تحديث خيارات السور
                    surahSelect.innerHTML = '';
                    surahs.forEach(surah => {
                        const option = document.createElement('option');
                        option.value = surah.number;
                        option.textContent = surah.name;
                        surahSelect.appendChild(option);
                    });

                    // تحديث خيارات القراء
                    reciterSelect.innerHTML = '';
                    reciters.forEach(reciter => {
                        const option = document.createElement('option');
                        option.value = reciter.identifier;
                        option.textContent = reciterArabicNames[reciter.identifier] || reciter.englishName;
                        reciterSelect.appendChild(option);
                    });

                    // تحديث خيارات التفاسير
                    tafsirSelect.innerHTML = '';
                    tafsirs.forEach(tafsir => {
                        const option = document.createElement('option');
                        option.value = tafsir.identifier;
                        option.textContent = tafsir.name;
                        tafsirSelect.appendChild(option);
                    });

                    // تعيين القيم الافتراضية
                    reciterSelect.value = "ar.alafasy";
                    tafsirSelect.value = "ar.jalalayn";

                } catch (err) {
                    console.error('Error loading initial data:', err);
                    alert('حدث خطأ أثناء تحميل البيانات الأولية: ' + err.message);
                }
            }

            async function loadSurahData() {
                const reciter = reciterSelect.value;
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${currentSurah}/${reciter}`);
                    if (!response.ok) throw new Error('فشل في جلب بيانات السورة');
                    const data = await response.json();
                    currentSurahData = data.data;
                    surahTitle.textContent = currentSurahData.name;

                    // تحديث نطاق التكرار
                    repeatEnd.value = currentSurahData.ayahs.length;
                    tasmeeEnd.value = currentSurahData.ayahs.length;

                } catch (error) {
                    console.error('Error loading surah data:', error);
                    alert('حدث خطأ أثناء تحميل بيانات السورة: ' + error.message);
                }
                return true;
            }

            async function loadTafsirData() {
                const tafsir = tafsirSelect.value;
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${currentSurah}/${tafsir}`);
                    if (!response.ok) throw new Error('فشل في جلب بيانات التفسير');
                    const data = await response.json();
                    currentTafsirData = data.data;
                } catch (error) {
                    console.error('Error loading tafsir data:', error);
                    alert('حدث خطأ أثناء تحميل بيانات التفسير: ' + error.message);
                }
            }

            function updateAyahDisplay() {
                if (currentSurahData && currentSurahData.ayahs && currentSurahData.ayahs[currentAyah]) {
                    const ayah = currentSurahData.ayahs[currentAyah];
                    ayahText.textContent = ayah.text;
                    ayahNumber.textContent = `(الآية: ${ayah.numberInSurah})`;

                    if (currentTafsirData && currentTafsirData.ayahs && currentTafsirData.ayahs[currentAyah]) {
                        const tafsirAyah = currentTafsirData.ayahs[currentAyah];
                        tafsirText.textContent = tafsirAyah.text;
                    }
                }

                // التمرير إلى الآية في منتصف الشاشة بعد تحديث المحتوى
                setTimeout(() => {
                    if (ayahText) {
                        ayahText.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }, 100);
            }

            function playAyah() {
                if (currentSurahData && currentSurahData.ayahs && currentSurahData.ayahs[currentAyah]) {
                    const ayah = currentSurahData.ayahs[currentAyah];
                    audioPlayer.src = ayah.audio;
                    audioPlayer.play().catch(e => console.error('Audio play error:', e));
                }
            }

            async function loadAyaData() {
                if (ayaData.length) return;
                try {
                    const response = await fetch("hafs_smart_v8.json");
                    if (!response.ok) {
                        throw new Error("تعذر تحميل ملف الآيات. تأكد من وجود الملف وفتح الصفحة عبر خادم محلي.");
                    }
                    ayaData = await response.json();
                } catch (err) {
                    let container = document.getElementById("search-results-container");
                    if (!container) {
                        container = document.createElement("div");
                        container.id = "search-results-container";
                        container.style.marginTop = "20px";
                        document.body.appendChild(container);
                    }
                    container.innerHTML = `<div style='color:red;padding:10px;text-align:center;'>${err.message}</div>`;
                    container.classList.remove("hidden");
                    ayaData = [];
                }
            }

            function displaySearchResults(results) {
                let container = document.getElementById("search-results-container");
                if (!container) {
                    container = document.createElement("div");
                    container.id = "search-results-container";
                    container.style.marginTop = "20px";
                    document.body.appendChild(container);
                }

                container.className = "search-results-container";

                if (!results.length) {
                    container.innerHTML = `<div class="p-4 text-center text-red-500">لم يتم العثور على نتائج.</div>`;
                    container.classList.remove("hidden");
                    return;
                }

                let html = `<div class="results-count">عدد النتائج: ${results.length}</div>`;

                const tashkeelRegex = /([\u064B-\u0652\u0670\u0653\u0654\u0655])/g;
                html += results.map(item => {
                    const coloredAyah = item.aya_text.replace(tashkeelRegex, '<span class="tashkeel-red">$1</span>');
                    return `
                    <div class="search-result" data-surah="${item.sura_no}" data-ayah="${item.aya_no}">
                        <div class="quran-text">${coloredAyah}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-300 mt-1"><strong>${item.sura_name_ar} - آية ${item.aya_no}</strong></div>
                    </div>
                    `;
                }).join('');

                container.innerHTML = html;
                container.classList.remove("hidden");

                // إضافة مستمعي الأحداث لنتائج البحث
                document.querySelectorAll('.search-result').forEach(item => {
                    item.addEventListener('click', async function () {
                        const surahNo = parseInt(this.dataset.surah);
                        const ayahNo = parseInt(this.dataset.ayah);

                        // تحديث حالة التطبيق
                        currentSurah = surahNo;
                        currentAyah = ayahNo - 1; // لأن الفهارس تبدأ من 0

                        // تحديث خيار السورة
                        surahSelect.value = currentSurah;

                        // تحميل وعرض الآية
                        await loadSurahData();
                        await loadTafsirData();
                        updateAyahDisplay();

                        // إخفاء نتائج البحث ومسح الاستعلام
                        searchResultsContainer.classList.add('hidden');
                        searchQuery.value = '';

                        // التبديل إلى تبويب المشغل
                        document.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
                        document.querySelector('[data-tab="player"]').classList.add('active');
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                        document.getElementById('player-tab').classList.remove('hidden');

                        // تشغيل الآية تلقائياً
                        playIcon.classList.remove('fa-play');
                        playIcon.classList.add('fa-pause');
                        isPlaying = true;
                        playAyah();
                    });
                });
            }

            async function searchAyat(query) {
                await loadAyaData();
                const results = ayaData.filter(item =>
                    item.aya_text_emlaey.includes(query) || item.aya_text.includes(query)
                );
                displaySearchResults(results);
            }

            function generateTasmeePlaceholders(start, end) {
                tasmeeOutput.innerHTML = '';
                for (let i = start; i <= end; i++) {
                    const ayahIndex = i - 1;
                    const placeholder = document.createElement('div');
                    placeholder.className = 'ayah-placeholder';
                    placeholder.textContent = i;

                    placeholder.addEventListener('click', () => {
                        if (currentSurahData && currentSurahData.ayahs && currentSurahData.ayahs[ayahIndex]) {
                            if (placeholder.classList.contains('revealed')) {
                                placeholder.textContent = i;
                                placeholder.classList.remove('revealed');
                            } else {
                                placeholder.textContent = currentSurahData.ayahs[ayahIndex].text;
                                placeholder.classList.add('revealed');
                            }
                        }
                    });

                    tasmeeOutput.appendChild(placeholder);
                }
            }

            // Initialize the app
            async function initApp() {
                // جلب البيانات الأولية
                await fetchInitialData();

                // تحميل بيانات السورة الأولى
                await loadSurahData();
                await loadTafsirData();
                updateAyahDisplay();

                // إنشاء عناصر التسميع الأولية
                generateTasmeePlaceholders(1, 7);
            }

            initApp();

            // ===== PWA Functionality =====
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.classList.remove('hidden');

                installButton.addEventListener('click', () => {
                    installButton.classList.add('hidden');
                    deferredPrompt.prompt();

                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        } else {
                            console.log('User dismissed the install prompt');
                        }
                        deferredPrompt = null;
                    });
                });
            });

            // ===== Offline Indicator =====
            window.addEventListener('online', () => {
                offlineIndicator.classList.add('hidden');
            });

            window.addEventListener('offline', () => {
                offlineIndicator.classList.remove('hidden');
            });

            // تحقق من حالة الاتصال عند التحميل
            if (!navigator.onLine) {
                offlineIndicator.classList.remove('hidden');
            }

            // ===== Service Worker Registration =====
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('service-worker.js')
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.log('Service Worker registration failed:', error);
                        });
                });
            }

            // ===== Notification Reminders =====
            function checkReminderTime() {
                if (!globalNotificationsEnabled) return;

                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();

                // تحقق من التذكيرات
                if (morningReminderEnabled) {
                    const morningTime = document.getElementById('morning-time').value.split(':');
                    checkSpecificTime(parseInt(morningTime[0]), parseInt(morningTime[1]), "حان وقت أذكار الصباح");
                }

                if (eveningReminderEnabled) {
                    const eveningTime = document.getElementById('evening-time').value.split(':');
                    checkSpecificTime(parseInt(eveningTime[0]), parseInt(eveningTime[1]), "حان وقت أذكار المساء");
                }

                if (sleepReminderEnabled) {
                    const sleepTime = document.getElementById('sleep-time').value.split(':');
                    checkSpecificTime(parseInt(sleepTime[0]), parseInt(sleepTime[1]), "حان وقت أذكار النوم");
                }
            }

            function checkSpecificTime(hour, minute, message) {
                const now = new Date();
                if (now.getHours() === hour && now.getMinutes() === minute) {
                    showNotification(message);
                }
            }

            function showNotification(message) {
                if (!("Notification" in window)) return;

                if (Notification.permission === "granted") {
                    new Notification("تذكير بالأذكار", {
                        body: message,
                        icon: "/icons/icon-96x96.png"
                    });
                }
            }

            // طلب الإذن للإشعارات
            document.getElementById('notification-toggle').addEventListener('click', () => {
                if (!("Notification" in window)) {
                    alert("الإشعارات غير مدعومة في متصفحك");
                    return;
                }

                if (Notification.permission !== "granted") {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            alert("تم تفعيل الإشعارات بنجاح");
                        }
                    });
                }
            });

            // التحقق من التذكيرات كل دقيقة
            setInterval(checkReminderTime, 60000);

            // ===== Reminder Toggles =====
            document.getElementById('global-notification-toggle').addEventListener('change', function () {
                globalNotificationsEnabled = this.checked;
                localStorage.setItem('globalNotifications', this.checked);
            });

            document.getElementById('morning-reminder-toggle').addEventListener('change', function () {
                morningReminderEnabled = this.checked;
                localStorage.setItem('morningReminder', this.checked);
            });

            document.getElementById('evening-reminder-toggle').addEventListener('change', function () {
                eveningReminderEnabled = this.checked;
                localStorage.setItem('eveningReminder', this.checked);
            });

            document.getElementById('sleep-reminder-toggle').addEventListener('change', function () {
                sleepReminderEnabled = this.checked;
                localStorage.setItem('sleepReminder', this.checked);
            });

            // تحميل إعدادات التذكير من localStorage
            function loadReminderSettings() {
                const global = localStorage.getItem('globalNotifications');
                const morning = localStorage.getItem('morningReminder');
                const evening = localStorage.getItem('eveningReminder');
                const sleep = localStorage.getItem('sleepReminder');

                if (global !== null) {
                    globalNotificationsEnabled = global === 'true';
                    document.getElementById('global-notification-toggle').checked = globalNotificationsEnabled;
                }

                if (morning !== null) {
                    morningReminderEnabled = morning === 'true';
                    document.getElementById('morning-reminder-toggle').checked = morningReminderEnabled;
                }

                if (evening !== null) {
                    eveningReminderEnabled = evening === 'true';
                    document.getElementById('evening-reminder-toggle').checked = eveningReminderEnabled;
                }

                if (sleep !== null) {
                    sleepReminderEnabled = sleep === 'true';
                    document.getElementById('sleep-reminder-toggle').checked = sleepReminderEnabled;
                }
            }

            loadReminderSettings();
        });


        // ===== بدء التطبيق =====
        initApp();

        // ===== تحسينات للأجهزة المحمولة =====
        if (/iPhone|iPad|iPod/.test(navigator.userAgent) && !window.matchMedia('(display-mode: standalone)').matches) {
            const message = document.createElement('div');
            message.innerHTML = `
                    <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: #fff; color: #333; padding: 15px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 9999;">
                        <strong>لتثبيت التطبيق:</strong><br> اضغط على زر <span style="font-weight:bold;">المشاركة</span> واختر <span style="font-weight:bold;">"إضافة إلى الشاشة الرئيسية"</span>.
                    </div>
                `;
            document.body.appendChild(message);
        }




    </script>
</body>

</html>